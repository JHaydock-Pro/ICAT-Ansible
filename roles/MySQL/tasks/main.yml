---
- name: Installing MySQL Packages - Specifically '{{ mysql_packages }}' 
  yum: 
    name: "{{ mysql_packages }}" 
    state: latest 

- name: Removing default engine setting 
  lineinfile: 
    path: "{{ mysql_cnf_path }}" 
    state: absent 
    regexp: 'default_storage_engine =' 
    
- name: Setting default engine to '{{ mysql_cnf_eng }}' 
  lineinfile: 
    path: /etc/my.cnf 
    insertafter: '[mysqld] ' 
    line: default_storage_engine = {{ mysql_cnf_eng }} 
 
- name: Starting database 
  service: 
    name: mysqld 
    state: started 
     
- name: Running '{{ mysql_secure }}' 
  expect: 
    command: "{{ mysql_secure }}" 
    responses: 
      password: "pw"               #Current root pass -CHANGE THIS LATER!(pw is not default pass)
      Question: 
        - y                        #Reset root password
        - "{{ mysql_root_pass }}"  #New root password
        - "{{ mysql_root_pass }}"  #New root password
        - y                        #Remove anonymous accounts
        - n                        #Disallow remote root login
        - y                        #Remove test database
        - y                        #Reload privilage tables (Above changes take effect)
 
- name: Creating database - {{ mysql_db_name }} 
  mysql_db: 
    login_user: root 
    login_password: "{{ mysql_root_pass }}" 
    name: "{{ mysql_db_name }}" 
    state: present 
 
- name: Creating Database login - user={{ mysql_user_name }} pass={{ mysql_user_pass }} 
  mysql_user: 
    login_user: root 
    login_password: "{{ mysql_root_pass }}" 
    name: "{{ mysql_user_name }}" 
    password: "{{ mysql_user_pass }}" 
    priv: '*.*:ALL,GRANT' 
    state: present 
