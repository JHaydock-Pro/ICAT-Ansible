---
# tasks file for /etc/ansible/roles/TestData

- name: Installing Ruby Dependencies
  yum:
    name: "{{ ruby_packages }}"
    state: latest
  become: yes
  become_user: root
  become_method: sudo

- name: Installing 'Ruby 2.3.1'
  shell:
    cmd: "{{ item }}"
  with_items:
    - curl -sSL https://get.rvm.io | bash
#    - source /home/{{ user_name }}/.rvm/scripts/rvm
    - /home/{{ user_name }}/.rvm/bin/rvm install --default 2.3.1 
    - /home/{{ user_name }}/.rvm/scripts/rvm gem install faker rest-client

- name: Downloading Lorem Ipsum script
  get_url:
    url: "{{ lorem_src }}"
    dest: "{{ download_dir }}"

- name: Moving script
  copy:
    src: "{{ download_dir }}{{ lorem_script }}"
    dest: "/home/{{ user_name }}/{{ lorem_script_edit }}"

- name: Rewriting script
  lineinfile:
    path: "/home/{{ user_name }}/{{ lorem_script_edit }}"
    regexp: "password =>"
    line: "{:password => {{ mysql_root_pass }}}"
  
- name: Running Lorem Ipsum
  shell:  
    cmd: "/home/{{ user_name }}/.rvm/scripts/rvm {{ lorem_script_edit }}"
    chdir: "/home/{{ user_name }}"
