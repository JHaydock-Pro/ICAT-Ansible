#---Notifcations---

notifications:
  email: false

#---Language---

language: python

#---Branches---

branches:
  only:
    - master

#---Environment---

sudo: required

#---Services---

#-----BEGIN BUILD-----

 #--Before Install--

addons:
  firefox: latest
  chrome: stable

 #--Install--

install:
  - pip install ansible
  - pip install selenium

 #--Before Script--

 #--Script--

# Many warnings are ignored on the Idempotence run, this is to reduce clutter, making it easier to see which tasks are not idempotent, all default warnings are enabled for the first run

script:
  - "echo 'allow_world_readable_tmpfiles=True' >> ansible.cfg"		# Allows world readable temp files, not secure should only be used within Travis
  - "sed -i 's/authn_simple: false/authn_simple: true/g' config.yml"	# Set Authn Simple to true
  - "sed -i 's/authn_db: false/authn_db: true/g' config.yml"		# Set Authn DB to true
  - "sed -i 's/authn_ldap: false/authn_ldap: true/g' config.yml"	# Set Authn LDAP to true
  - "sed -i 's/authn_anon: false/authn_anon: true/g' config.yml"	# Set Authn Anon to true
  - "ANSIBLE_CONFIG=ansible.cfg ansible-playbook -i tests/inventory tests/test.yml --connection=local"
#
  - "echo 'Deletion Script Test'"
  - "sed -i 's/delete_fac: false/delete_fac: true/g' config.yml"	# Test Deletion Script
  - "ANSIBLE_CONFIG=ansible.cfg ansible-playbook -i tests/inventory tests/test.yml --connection=local --tags 'pycat'"
#
  - "echo 'Idempotence Test"
  - "sed -i 's/delete_fac: true/delete_fac: false/g' config.yml"	# Test Idempotence
  - "echo 'stdout_callback = actionable' >> ansible.cfg"		# Only Output Changed or Failed Tasks
  - "echo 'deprecation_warnings = False' >> ansible.cfg"		# Ignore Depriciation Warnings
  - "echo 'command_warnings = False' >> ansible.cfg"			# Ignore Command Module Warnings
  - "echo 'system_warnings = False' >> ansible.cfg"			# Ignore System Warnings
  - "cat ansible.cfg"
  - "ANSIBLE_CONFIG=ansible.cfg ansible-playbook -i tests/inventory tests/test.yml --connection=local --diff"  
# Reduce changed tasks to lowest possible number (0 if possible) then check that changed value does not exceed that, fail if it does 
#
# download chrome/firefox webdrivers
# add path of executables to bash
# run topcat_test.py, tee output
# grep ^ output fail if the string 'Failed' appears


 #--After Script--

 #--Before Deploy--

 #--Deploy--

 #--After Deploy--
