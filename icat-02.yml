---
 - hosts: all
   remote_user: root
   strategy: debug
 #These will be moved to external file so they can be changed easily by users
   vars:
   #Java
     java_packages: java-1.8.0-openjdk-devel
   #Python
     python_packages: python, pexpect
   #MySQL
     mysql_packages: mysql-server, mysql, MySQL-python, python-suds, python-requests, mysql-connector-java
     mysql_cnf_path: /etc/my.cnf
     mysql_cnf_eng: InnoDB
     mysql_secure: mysql_secure_installation
     mysql_root_pass: pw
     mysql_db_name: icat
     mysql_user_name: icat
     mysql_user_pass: icat
   #Non-Root User
     user_name: glassfish
     user_pass: pw

   tasks:
     - debug:
         msg: Hello, I see you are running {{ ansible_distribution }} {{ ansible_distribution_major_version }}.
       tags:
         - hello

     - name: Updating package list
       yum:
         name: '*'
         state: latest
       tags:
         - debugged

#-Java-----------------------------------------------------------------------------
     - name: Installing Java - Specifically '{{ java_packages }}'
       yum: 
         name: "{{ java_packages }}"
         state: latest
       tags:
         - java
         - debugged

#-Python--------------------------------------------------------------------------
     - name: Installing Python
       yum:
         name: python
         state: latest
       tags:
         - python
         - debugged

     - name: Installing Pexpect
       pip:
         name: pexpect
         state: latest
       tags:
         - python        
         - debugged

#-MySQL----------------------------------------------------------------------------
     - name: Installing MySQL Packages - Specifically '{{ mysql_packages }}'
       yum:
         name: "{{ mysql_packages }}"
         state: latest
       tags:
         - mysql
         - debugged

     - name: Configuring MySQL - Removing default engine setting
       lineinfile:
         path: "{{ mysql_cnf_path }}"
         state: absent
         regexp: 'default_storage_engine ='
       tags:
         - mysql
         - debugged
  
     - name: Configuring MySQL - Setting default engine to '{{ mysql_cnf_eng }}'
       lineinfile:
         path: /etc/my.cnf
         insertafter: '[mysqld] '
         line: default_storage_engine = {{ mysql_cnf_eng }}
       tags:
         - mysql
         - debugged

     - name: Confuguring MySQL - Starting database
       service:
         name: mysqld
         state: started
       tags:
         - mysql
         - debugged
   
     - name: Configuring MySQL - Running '{{ mysql_secure }}'
       expect:
         command: "{{ mysql_secure }}"
         responses:
           password: "pw"
           Question:
             - y
             - "{{ mysql_root_pass }}"
             - "{{ mysql_root_pass }}"
             - y
             - n
             - y
             - y
       tags:
         - mysql
         - debugged
     
     - debug:
         msg: The root password is now '{{ mysql_root_pass }}'
       tags:
         - mysql
         - debugged

     - name: Creating MySQL Database - {{ mysql_db_name }}
       mysql_db:
         login_user: root
         login_password: "{{ mysql_root_pass }}"
         name: "{{ mysql_db_name }}"
         state: present
       tags:
         - mysql
         - debugged

     - name: Creating Database login - user={{ mysql_user_name }} pass={{ mysql_user_pass }}
       mysql_user:
         login_user: root
         login_password: "{{ mysql_root_pass }}"
         name: "{{ mysql_user_name }}"
         password: "{{ mysql_user_pass }}"
         priv: '*.*:ALL,GRANT'
         state: present
       tags:
         - mysql
#         - debugged

#-non-root account--------------------------------------------------------------------------------

#     - name: Creating Non-Root User
#       user:
#         name: "{{ user_name }}"
#         update_password: always
#         password: pw
#         state: present
